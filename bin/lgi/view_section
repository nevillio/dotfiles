#!/usr/bin/env bash

. ~/work/scripts/stb_ops

if [[ -n "$1" ]]; then
	if config_data=$(get_section "$1" ); then
		word_count=$(echo "$config_data" | wc -L)
		if [[ $word_count -lt 81 ]]; then
			echo "$config_data"
		else
			echo "$config_data" | nvim -c "set buftype=nofile" -c "set filetype=json" -
		fi
	else
		echo "Error: failed to get config '$1'" >&2
		exit 1
	fi
else
	temp_file=$(mktemp)
	if get_section > "$temp_file"; then
		nvim -c "set buftype=nofile" -c "set filetype=json" "$temp_file" 
		rm "$temp_file"
	else 
		echo "Error: Failed to get config" >&2
		rm "$temp_file"
		exit 1
	fi
fi


